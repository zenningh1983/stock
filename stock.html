<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>股票收益儀表板</title>

<style>
    body {
        margin: 0;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: #f5f5f5;
        color: #333;
    }

    h1 {
        text-align: center;
        margin-bottom: 5px;
        font-weight: 600;
    }

    .tabs {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 25px;
    }

    .tab {
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        background: #e6e6e6;
        transition: 0.2s;
    }

    .tab:hover {
        background: #dcdcdc;
    }

    .tab.active {
        background: #c8c8c8;
    }

    .section {
        max-width: 600px;
        margin: 0 auto;
        background: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    label {
        display: block;
        font-size: 15px;
        margin-top: 12px;
        font-weight: 600;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 16px;
        box-sizing: border-box;
        background: #fafafa;
    }

    textarea {
        height: 60px;
    }

    .row {
        display: flex;
        gap: 15px;
    }

    .row > div {
        flex: 1;
    }

    .radio-row {
        display: flex;
        gap: 30px;
        align-items: center;
        margin-top: 8px;
    }

    .radio-row label {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 16px;
        margin: 0;
    }

    .radio-row input {
        margin-right: 6px;
    }

    button {
        width: 100%;
        padding: 12px;
        margin-top: 18px;
        background: #b7c4b8;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        cursor: pointer;
        transition: 0.2s;
    }

    button:hover {
        background: #a3b1a7;
    }

    .toast {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 16px 24px;
        border-radius: 8px;
        color: white;
        font-size: 18px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        z-index: 9999;
    }

    .toast.show {
        opacity: 1;
    }

    .toast-success {
        background: rgba(130,160,140,0.9);
    }

    .toast-error {
        background: rgba(200,80,80,0.9);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        text-align: left;
    }

    th {
        background: #ededed;
        cursor: pointer;
    }

    @media (max-width: 600px) {
        .section {
            width: 100%;
            padding: 15px;
        }
        input, select, textarea {
            font-size: 15px;
        }
    }
</style>
</head>

<body>

<h1>股票收益儀表板</h1>

<div class="tabs">
    <div class="tab active" data-target="add">新增交易</div>
    <div class="tab" data-target="overview">我的庫存</div>
    <div class="tab" data-target="records">明細</div>
</div>

<!-- 新增交易 -->
<div class="section" id="add">
    <label>帳戶</label>
    <select id="account">
        <option value="元大證券">元大證券</option>
        <option value="國泰證券">國泰證券</option>
    </select>

    <label>代號</label>
    <input id="symbol" type="text" placeholder="例：2330" />

    <label>交易類型</label>
    <div class="radio-row">
        <label><input type="radio" name="type" value="Buy" checked> Buy</label>
        <label><input type="radio" name="type" value="Sell"> Sell</label>
        <label><input type="radio" name="type" value="Bonus"> Bonus</label>
    </div>

    <label>日期</label>
    <input id="date" type="date" />

    <div class="row">
        <div>
            <label>股數</label>
            <input id="shares" type="number" placeholder="例：1000">
        </div>
        <div>
            <label>單價</label>
            <input id="price" type="number" step="0.01" placeholder="">
        </div>
    </div>

    <label>金額（股利時需填）</label>
    <input id="amount" type="number" step="0.01">

    <label>備註</label>
    <textarea id="note"></textarea>

    <button onclick="submitForm()">送出</button>
</div>

<!-- 我的庫存 -->
<div class="section" id="overview" style="display:none;">
    <h3>庫存總覽（簡易版）</h3>
    <p>稍後可進階製作損益統計。</p>
</div>

<!-- 明細 -->
<div class="section" id="records" style="display:none;">
    <h3>所有交易明細</h3>
    <table>
        <thead>
            <tr>
                <th>帳戶</th>
                <th>代號</th>
                <th>類型</th>
                <th>日期</th>
                <th>股數</th>
                <th>單價</th>
                <th>金額</th>
                <th>備註</th>
            </tr>
        </thead>
        <tbody id="recordBody"></tbody>
    </table>
</div>

<div id="toast" class="toast"></div>

<script>
/* ------------ Tabs ------------ */
document.querySelectorAll(".tab").forEach(tab => {
    tab.onclick = () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");

        document.querySelectorAll(".section").forEach(sec => sec.style.display = "none");
        document.getElementById(tab.dataset.target).style.display = "block";
    };
});

/* ------------ 預設今日日期 ------------ */
document.getElementById("date").value = new Date().toISOString().split("T")[0];

/* ------------ Toast ------------ */
function showToast(msg, success = true) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.className = "toast " + (success ? "toast-success" : "toast-error");
    t.classList.add("show");

    setTimeout(() => {
        t.classList.remove("show");
    }, 1000);
}

/* ------------ 自動查股價 (Finnhub) ------------ */
document.getElementById("symbol").addEventListener("blur", async function () {
    const raw = this.value.trim();
    if (!raw) return;

    const isNumber = /^\d+$/.test(raw);
    const symbol = isNumber ? raw + ".TW" : raw;

    const url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=d4kjl11r01qvpdokli30d4kjl11r01qvpdokli3g`;

    try {
        const res = await fetch(url);
        const data = await res.json();

        if (data.c) {
            document.getElementById("price").value = data.c.toFixed(2);
        } else {
            showToast("查不到價格", false);
        }
    } catch {
        showToast("查價失敗", false);
    }
});

/* ------------ LocalStorage ------------ */
function submitForm() {
    let account = document.getElementById("account").value.trim();
    let symbol = document.getElementById("symbol").value.trim();
    let type = document.querySelector("input[name='type']:checked").value;
    let date = document.getElementById("date").value;
    let shares = document.getElementById("shares").value;
    let price = document.getElementById("price").value;
    let amount = document.getElementById("amount").value;
    let note = document.getElementById("note").value;

    if (!account || !symbol || !type || !date || (type !== "Bonus" && (!shares || !price)) || (type === "Bonus" && !amount)) {
        showToast("有欄位未填", false);
        return;
    }

    let list = JSON.parse(localStorage.getItem("stockRecords") || "[]");
    list.push({ account, symbol, type, date, shares, price, amount, note });
    localStorage.setItem("stockRecords", JSON.stringify(list));

    showToast("送出成功", true);
    renderRecords();

    document.querySelector(".tab[data-target='records']").click();
}

/* ------------ 顯示明細 ------------ */
function renderRecords() {
    let list = JSON.parse(localStorage.getItem("stockRecords") || "[]");
    let tbody = document.getElementById("recordBody");
    tbody.innerHTML = "";

    list.forEach(r => {
        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${r.account}</td>
            <td>${r.symbol}</td>
            <td>${r.type}</td>
            <td>${r.date}</td>
            <td>${r.shares || ""}</td>
            <td>${r.price || ""}</td>
            <td>${r.amount || ""}</td>
            <td>${r.note || ""}</td>
        `;
        tbody.appendChild(tr);
    });
}

renderRecords();
</script>
</body>
</html>
