<!DOCTYPE html><html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‚¡ç¥¨æ”¶ç›Šå„€è¡¨æ¿</title>

<style>
body{
  font-family:'Noto Sans TC',sans-serif;
  background:#F5F5F3;
  margin:0;
  padding:20px;
  color:#333;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h2{margin-bottom:14px;font-weight:600;text-align:center;}

.tabs{
  display:flex;gap:10px;margin-bottom:20px;justify-content:center;width:100%;max-width:1000px;
}
.tab{
  padding:10px 20px;background:#D8D8D4;border-radius:6px;cursor:pointer;
  color:#444;font-weight:600;transition:.2s;
}
.tab:hover{background:#C6C6C2;}
.tab.active{background:#AFAFA8;color:white;}

.tabContent{
  display:none;
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 2px 5px #0002;
  width:100%;
  max-width:1000px;
  box-sizing:border-box;
}
.tabContent.active{display:block;}

.row{
  display:flex;
  align-items:center;
  margin-bottom:14px;
  gap:10px;
  flex-wrap:wrap;
}

.row label{width:90px;font-weight:600;}

input,select,textarea{
  padding:8px;border-radius:6px;border:1px solid #C8C8C5;flex:1;
  font-size:14px;background:#FAFAF8;
}

textarea{height:60px;resize:none;}

.type-option{display:flex;align-items:center;gap:6px;margin-right:10px;}

.btn{
  width:100%;padding:12px;border-radius:8px;background:#AFAFA8;
  color:white;border:none;font-size:15px;cursor:pointer;font-weight:600;margin-top:10px;
}
.btn:hover{background:#8E8E88;}

#toast{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  min-width:180px;
  text-align:center;
  background:rgba(180,180,170,0.85);
  color:#333;
  padding:16px 28px;
  border-radius:14px;
  font-size:16px;
  opacity:0;
  transition:opacity .25s;
  z-index:9999;
  pointer-events:none;
}
#toast.err{
  background:rgba(200,80,80,0.85);
  color:white;
}

.tableWrapper{width:100%;overflow-x:auto;}

table{
  width:100%;min-width:700px;border-collapse:collapse;background:#FAFAF9;font-size:15px;
}
th{background:#D6D6D2;padding:10px;text-align:left;}
td{padding:10px;border-bottom:1px solid #E5E5E5;word-break:break-word;}

@media(max-width:600px){
  .tabContent{max-width:420px;}
  table{font-size:13px;}
  th,td{padding:8px;}
}
</style>
</head>

<body>

<h2>ğŸ“ˆ è‚¡ç¥¨æ”¶ç›Šå„€è¡¨æ¿</h2>
<div id="toast"></div>

<div class="tabs">
  <div class="tab active" data-tab="add">æ–°å¢äº¤æ˜“</div>
  <div class="tab" data-tab="portfolio">æˆ‘çš„åº«å­˜</div>
</div>

<div id="add" class="tabContent active">

<h3>æ–°å¢äº¤æ˜“ç´€éŒ„</h3>

<div class="row">
  <label>å¸³æˆ¶</label>
  <select id="fAcc">
    <option>åœ‹æ³°è­‰åˆ¸</option>
    <option>å…ƒå¤§è­‰åˆ¸</option>
  </select>
</div>

<div class="row">
  <label>ä»£è™Ÿ</label>
  <input id="fCode">
</div>

<div class="row">
  <label>äº¤æ˜“é¡å‹</label>
  <div class="type-option"><input type="radio" name="fType" value="Buy" checked> Buy</div>
  <div class="type-option"><input type="radio" name="fType" value="Sell"> Sell</div>
  <div class="type-option"><input type="radio" name="fType" value="Bonus"> Bonus</div>
</div>

<div class="row">
  <label>æ—¥æœŸ</label>
  <input id="fDate" type="date">
</div>

<div class="row" id="rowQty">
  <label>è‚¡æ•¸</label>
  <input id="fQty" type="number" value="1000">
</div>

<div class="row" id="rowPrice">
  <label>å–®åƒ¹</label>
  <input id="fPrice" type="number">
</div>

<div class="row" id="rowAmount" style="display:none;">
  <label>é‡‘é¡</label>
  <input id="fAmount" type="number">
</div>

<div class="row">
  <label>å‚™è¨»</label>
  <textarea id="fNote"></textarea>
</div>

<button class="btn" id="btnSubmit">é€å‡º</button>

</div>


<div id="portfolio" class="tabContent">
<h3>å…¨éƒ¨æ˜ç´°</h3>

<div class="tableWrapper">
<table>
<thead>
<tr>
<th>å¸³æˆ¶</th><th>ä»£è™Ÿ</th><th>é¡å‹</th>
<th>è‚¡æ•¸/é‡‘é¡</th><th>å–®åƒ¹</th><th>æ—¥æœŸ</th><th>å‚™è¨»</th>
</tr>
</thead>
<tbody id="allRows"></tbody>
</table>
</div>

</div>



<script>
let data=[];

/* ---- Toast ---- */
function showToast(message,isErr){
  const t=document.getElementById("toast");
  t.innerHTML=message;
  if(isErr){
    t.classList.add("err");
  }else{
    t.classList.remove("err");
  }
  t.style.opacity=1;
  setTimeout(()=>{t.style.opacity=0;},1000);
}


/* ---- é¡å‹åˆ‡æ› ---- */
document.querySelectorAll("input[name='fType']").forEach(r=>{
  r.addEventListener("change",()=>{
    const isBonus=r.value==="Bonus";
    document.getElementById("rowQty").style.display=isBonus?"none":"flex";
    document.getElementById("rowPrice").style.display=isBonus?"none":"flex";
    document.getElementById("rowAmount").style.display=isBonus?"flex":"none";
  });
});


/* ---- è‡ªå‹•æŸ¥è‚¡åƒ¹ï¼ˆcodetabsï¼‰ ---- */
document.getElementById("fCode").addEventListener("blur", async function(){

  let code = this.value.trim();
  if(!code) return;

  let symbol = "";

  if(/^\d+$/.test(code)){      
    symbol = code + ".TW";
  } else {                     
    symbol = code.toUpperCase();
  }

  const api = 
`https://api.codetabs.com/v1/proxy/?quest=https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}`;

  try{
    const res = await fetch(api);
    const json = await res.json();

    const result = json.quoteResponse?.result?.[0];
    const price = result?.regularMarketPrice;

    if(price){
      const p = Number(price).toFixed(2);
      document.getElementById("fPrice").value = p;
      showToast("å–å¾—è‚¡åƒ¹ï¼š"+p,false);
    }else{
      showToast("æŸ¥ä¸åˆ°è‚¡åƒ¹",true);
    }

  }catch(e){
    showToast("æŸ¥è©¢å¤±æ•—",true);
  }
});


/* ---- é€å‡º ---- */
document.getElementById("btnSubmit").onclick=function(){

  const acc = document.getElementById("fAcc").value.trim();
  const code = document.getElementById("fCode").value.trim();
  const type = document.querySelector("input[name='fType']:checked").value;
  const dateVal = document.getElementById("fDate").value;
  const qtyVal = document.getElementById("fQty").value;
  const priceVal = document.getElementById("fPrice").value;
  const amountVal = document.getElementById("fAmount").value;
  const noteVal = document.getElementById("fNote").value.trim();

  if(type==="Buy"||type==="Sell"){
    if(!acc||!code||!dateVal||!qtyVal||!priceVal){
      showToast("ç¼ºå°‘æ¬„ä½",true);
      return;
    }
  }else{
    if(!acc||!code||!dateVal||!amountVal){
      showToast("ç¼ºå°‘æ¬„ä½",true);
      return;
    }
  }

  const finalQty = (type==="Bonus")?0:Number(qtyVal);
  const finalPrice = (type==="Bonus")?0:Number(priceVal);
  const finalAmount = (type==="Bonus")?Number(amountVal):finalQty*finalPrice;

  data.push({
    acc,code,type,
    qty:finalQty,price:finalPrice,
    amount:finalAmount,
    date:dateVal,
    note:noteVal
  });

  renderRows();
  showToast("é€å‡ºæˆåŠŸ",false);
};


/* ---- Tabs ---- */
document.querySelectorAll(".tab").forEach(t=>{
  t.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(a=>a.classList.remove("active"));
    document.querySelectorAll(".tabContent").forEach(c=>c.classList.remove("active"));
    t.classList.add("active");
    document.getElementById(t.dataset.tab).classList.add("active");
  });
});


/* ---- Render ---- */
function renderRows(){
  let html="";
  data.forEach(r=>{
    html+=`
    <tr>
      <td>${r.acc}</td>
      <td>${r.code}</td>
      <td>${r.type}</td>
      <td>${r.type==="Bonus"?r.amount:r.qty}</td>
      <td>${r.type==="Bonus"?"-":r.price}</td>
      <td>${r.date}</td>
      <td>${r.note}</td>
    </tr>`;
  });
  document.getElementById("allRows").innerHTML=html;
}
</script>

</body>
</html>
